<!-- the backdrop -->
<div class="backdrop" (click)="close()" aria-hidden="true"></div>

<!-- the panel -->
<div class="panel" role="dialog">
  <header class="panel-header">
    <h2 id="cart-title">My Cart</h2>
    <button #closeBtn class="close-btn" (click)="close()">
      <mat-icon class="icon">close_small</mat-icon>
    </button>
  </header>

  @if (cart.items.length === 0) {
  <p class="empty-msg">Your cart is empty!</p>
  } @else {
  <div class="list">
    @for (item of cart.items; track item.name) {
    <div class="row">
      <div class="meta">
        <div class="name">{{ item.name }}</div>
        <div class="price">{{ item.quantity * item.unitPrice }} L</div>
      </div>

      <div class="quantity">
        <button class="remove-item-btn" (click)="cart.removeItem(item.name)">
          <mat-icon class="icon">remove</mat-icon>
        </button>

        <div class="input-wrapper">
          <input
            class="count"
            min="1"
            [value]="item.quantity"
            [style.backgroundColor]="isEmpty(item.name) ? '#fe8181' : ''"
            (focus)="onQtyFocus(item.name)"
            (input)="onQtyInput(item.name, $event)"
            (blur)="onQtyBlur(item, $event)"
            step="1"
            inputmode="numeric"
          />
        </div>

        <button
          class="add-item-btn"
          (click)="cart.addItem({ name: item.name, unitPrice: item.unitPrice })"
        >
          <mat-icon class="icon">add</mat-icon>
        </button>
      </div>
    </div>
    }
  </div>

  <div class="summary">
    <div>Total items: {{ cart.getTotalQuantity() }}</div>
    <div>Amount: {{ cart.getTotalAmount() }} L</div>
  </div>

  <footer class="actions">
    <button class="btn warn" (click)="cart.clearCart()">Clear</button>
    <span class="spacer"></span>
    <button class="btn" (click)="close()">Close</button>
    <button class="btn primary" (click)="checkout()">Checkout</button>
  </footer>
  }
</div>
